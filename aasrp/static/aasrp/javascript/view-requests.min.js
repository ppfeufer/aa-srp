$(document).ready(()=>{const e=$("#tab_aasrp_srp_requests"),o=$("div.card-srp-request-bulk-actions"),t=e.DataTable({language:aaSrpSettings.dataTable.language,ajax:{url:aaSrpSettings.url.requestsForSrpLink,dataSrc:"",cache:!1},columns:[{data:"request_time",render:{display:e=>null===e?"":moment(e).utc().format(aaSrpSettings.datetimeFormat),sort:e=>null===e?"":e},className:"srp-request-time"},{data:"requester",className:"srp-request-requester"},{data:"character_html",render:{display:"display",filter:"sort",sort:"sort"},className:"srp-request-character"},{data:"request_code_html",render:{display:"display",filter:"sort",sort:"sort"},className:"srp-request-code"},{data:"ship_html",render:{display:"display",filter:"sort",sort:"sort"},className:"srp-request-ship"},{data:"zkb_loss_amount_html",render:{display:"display",filter:"sort",sort:"sort"},className:"srp-request-zbk-loss-amount text-end"},{data:"payout_amount_html",render:{display:"display",filter:"sort",sort:"sort"},className:"srp-request-payout text-end"},{data:"request_status_icon",className:"srp-request-status text-center"},{data:"actions",className:"srp-request-actions text-end"},{data:"request_code",className:"srp-request-bulk-actions-checkbox text-end",render:{display:e=>`<div class="checkbox"><label><input class="srp-requests-bulk-action" type="checkbox" name="${e}"><span class="cr"><i class="cr-icon fas fa-check"></i></span></label></div>`}},{data:"ship"},{data:"request_status_translated"},{data:"character"}],columnDefs:[{orderable:!1,targets:[7,8,9]},{visible:!1,targets:[10,11,12]},{width:115,targets:[8]}],order:[[0,"asc"]],filterDropDown:{columns:[{idx:1},{idx:12,title:aaSrpSettings.translation.filter.character},{idx:10,title:aaSrpSettings.translation.filter.ship},{idx:11,title:aaSrpSettings.translation.filter.requestStatus}],autoSize:!1,bootstrap:!0,bootstrap_version:5},paging:!1,createdRow:(e,t,a)=>{const r=t.request_code,s=t.request_status.toLowerCase(),o=t.payout_amount;$(e).attr("data-row-id",a).attr("data-srp-request-code",r).addClass("srp-request-status-"+s),$(e).find("span.srp-payout-amount").attr("data-value",o),"pending"!==s&&"rejected"!==s||($(e).find("td.srp-request-payout").addClass("srp-request-payout-amount-editable"),$(e).find("span.srp-payout-tooltip").attr("data-bs-tooltip","aa-srp").attr("title",aaSrpSettings.translation.changeSrpPayoutAmount),$(e).find("span.srp-payout-amount").addClass("srp-request-"+r).attr("data-pk",r).attr("data-params",`{csrfmiddlewaretoken:'${aaSrpSettings.csrfToken}'}`).attr("data-url",aaSrpSettings.url.changeSrpAmount.replace("SRP_REQUEST_CODE",r)))}}),r=(e,t)=>{t=parseInt(t);const a=`${new Intl.NumberFormat(aaSrpSettings.locale).format(t)} ISK`;e.attr("data-value",t).addClass("srp-payout-amount-changed").html(a);let r=0;const s=$("#tab_aasrp_srp_requests .srp-request-status-approved .srp-payout-amount"),o=(s.each((e,t)=>{r+=parseInt(t.getAttribute("data-value"))}),$(".srp-fleet-total-amount").html(`${new Intl.NumberFormat(aaSrpSettings.locale).format(r)} ISK`),e.parent().parent().find(".copy-to-clipboard-icon i"));o.attr("data-clipboard-text",t)},a=e=>{let a=0,r=0,s=0,o=0,n=0;$.each(e,(e,t)=>{r+=1,"Pending"===t.request_status&&(s+=1),"Approved"===t.request_status&&(a+=parseInt(t.payout_amount),o+=1),"Rejected"===t.request_status&&(n+=1)}),$(".srp-fleet-total-amount").html(`${new Intl.NumberFormat(aaSrpSettings.locale).format(a)} ISK`),$(".srp-requests-total-count").html(r),$(".srp-requests-pending-count").html(s),$(".srp-requests-approved-count").html(o),$(".srp-requests-rejected-count").html(n)},s=e=>{e.unbind("click")},n=e=>{!0===e.success&&t.ajax.reload(e=>{a(e)})},l=()=>{const e=$("td.srp-request-bulk-actions-checkbox input.srp-requests-bulk-action"),t=$(e).filter(":checked");return t.map((e,t)=>$(t).attr("name")).get()},c=()=>{const e=$("td.srp-request-bulk-actions-checkbox input.srp-requests-bulk-action"),t=$(e).filter(":checked");return t.map((e,t)=>$(t)).get()},d=(t.on("draw",()=>{e.editable({container:"body",selector:".srp-request-payout-amount-editable .srp-payout-amount",title:aaSrpSettings.translation.changeSrpPayoutHeader,type:"number",placement:"top",display:()=>!1,success:function(e,t){r($(this),t)},validate:e=>{if(""===e)return aaSrpSettings.translation.editableValidate}}),[].slice.call(document.querySelectorAll('[data-bs-tooltip="aa-srp"]')).map(e=>new bootstrap.Tooltip(e));const a=$("td.srp-request-bulk-actions-checkbox input.srp-requests-bulk-action");a.each((e,t)=>{$(t).change(()=>{const e=$(a).filter(":checked");0<e.length?o.removeClass("d-none"):o.addClass("d-none")})})}),$("#srp-request-details")),i=$("#srp-request-accept"),m=$("#srp-request-bulk-accept"),u=$("#srp-request-accept-rejected"),p=$("#srp-request-reject"),f=$("#srp-request-remove"),h=$("#srp-request-bulk-remove"),b="aa-callout aa-callout-danger aasrp-form-field-errors clearfix";d.on("show.bs.modal",e=>{const t=$(e.relatedTarget),a=t.data("link");fetchGet({url:a,responseIsJson:!1}).then(e=>{d.find(".modal-body").html(e)}).catch(e=>{console.log(`Error: ${e.message}`)})}).on("hide.bs.modal",()=>{d.find(".modal-body").text("")}),i.on("show.bs.modal",e=>{const t=$(e.relatedTarget),r=t.data("link");$("#modal-button-confirm-accept-request").on("click",()=>{const e=i.find("form"),t=e.find('textarea[name="comment"]').val(),a=e.find('input[name="csrfmiddlewaretoken"]').val();fetchPost({url:r,csrfToken:a,payload:{comment:t},responseIsJson:!0}).then(e=>{n(e)}).catch(e=>{console.log(`Error: ${e.message}`)}),i.modal("hide")})}).on("hide.bs.modal",()=>{i.find('textarea[name="comment"]').val(""),s($("#modal-button-confirm-accept-request"))}),u.on("show.bs.modal",e=>{const t=$(e.relatedTarget),s=t.data("link");$("#modal-button-confirm-accept-rejected-request").on("click",()=>{const e=u.find("form"),t=e.find('textarea[name="comment"]').val(),a=e.find('input[name="csrfmiddlewaretoken"]').val();if(""===t){const r=`<div class="${b}"><p>${aaSrpSettings.translation.modal.form.error.fieldRequired}</p></div>`;e.find(".aasrp-form-field-errors").remove(),$(r).insertAfter($('textarea[name="comment"]'))}else fetchPost({url:s,csrfToken:a,payload:{comment:t},responseIsJson:!0}).then(e=>{n(e)}).catch(e=>{console.log(`Error: ${e.message}`)}),u.modal("hide")})}).on("hide.bs.modal",()=>{u.find('textarea[name="comment"]').val(""),$(".aasrp-form-field-errors").remove(),s($("#modal-button-confirm-accept-rejected-request"))}),p.on("show.bs.modal",e=>{const t=$(e.relatedTarget),s=t.data("link");$("#modal-button-confirm-reject-request").on("click",()=>{const e=p.find("form"),t=e.find('textarea[name="comment"]').val(),a=e.find('input[name="csrfmiddlewaretoken"]').val();if(""===t){const r=`<div class="${b}"><p>${aaSrpSettings.translation.modal.form.error.fieldRequired}</p></div>`;e.find(".aasrp-form-field-errors").remove(),$(r).insertAfter($('textarea[name="comment"]'))}else fetchPost({url:s,csrfToken:a,payload:{comment:t},responseIsJson:!0}).then(e=>{n(e)}).catch(e=>{console.log(`Error: ${e.message}`)}),p.modal("hide")})}).on("hide.bs.modal",()=>{p.find('textarea[name="comment"]').val(""),$(".aasrp-form-field-errors").remove(),s($("#modal-button-confirm-reject-request"))}),f.on("show.bs.modal",e=>{const t=$(e.relatedTarget),a=t.data("link");$("#modal-button-confirm-remove-request").on("click",()=>{fetchGet({url:a}).then(e=>{n(e)}).catch(e=>{console.log(`Error: ${e.message}`)}),f.modal("hide")})}).on("hide.bs.modal",()=>{f.find('textarea[name="comment"]').val(""),s($("#modal-button-confirm-remove-request"))}),m.on("show.bs.modal",e=>{const t=$(e.relatedTarget),a=t.data("link"),r=m.find("form"),s=r.find('input[name="csrfmiddlewaretoken"]').val();$("#modal-button-confirm-bulk-accept-requests").on("click",()=>{const e=l();fetchPost({url:a,csrfToken:s,payload:{srp_request_codes:e},responseIsJson:!0}).then(e=>{n(e);const t=c();t.forEach(e=>{$(e).prop("checked",!1)}),o.addClass("d-none")}).catch(e=>{console.log(`Error: ${e.message}`)}),m.modal("hide")})}).on("hide.bs.modal",()=>{s($("#modal-button-confirm-bulk-accept-requests"))}),h.on("show.bs.modal",e=>{const t=$(e.relatedTarget),a=t.data("link"),r=h.find("form"),s=r.find('input[name="csrfmiddlewaretoken"]').val();$("#modal-button-confirm-bulk-remove-requests").on("click",()=>{const e=l();fetchPost({url:a,csrfToken:s,payload:{srp_request_codes:e},responseIsJson:!0}).then(e=>{n(e);const t=c();t.forEach(e=>{$(e).prop("checked",!1)}),o.addClass("d-none")}).catch(e=>{console.log(`Error: ${e.message}`)}),h.modal("hide")})}).on("hide.bs.modal",()=>{s($("#modal-button-confirm-bulk-remove-requests"))}),$("#aasrp-bulk-action-clear-selection").on("click",()=>{const e=c();e.forEach(e=>{$(e).prop("checked",!1)}),o.addClass("d-none")})});
//# sourceMappingURL=view-requests.min.js.map