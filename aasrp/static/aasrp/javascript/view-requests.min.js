$(document).ready(()=>{let a=$("#tab_aasrp_srp_requests"),o=a.DataTable({language:aaSrpSettings.dataTable.language,ajax:{url:aaSrpSettings.url.requestsForSrpLink,dataSrc:"",cache:!1},columns:[{data:"request_time",render:{_:a=>null===a?"":moment(a).utc().format(aaSrpSettings.datetimeFormat),sort:a=>null===a?"":a},className:"srp-request-time"},{data:"requester",className:"srp-request-requester"},{data:"character_html",render:{display:"display",_:"sort"},className:"srp-request-character"},{data:"request_code",render:(a,t)=>"display"===t?`<span>${a}<i class="aa-srp-fa-icon copy-text-fa-icon fa-regular fa-copy ms-2" data-clipboard-text="${a}" data-bs-tooltip="aa-srp" aria-label="${aaSrpSettings.translation.copyRequestCodeToClipboard}" title="${aaSrpSettings.translation.copyRequestCodeToClipboard}"></i></span>`:a,className:"srp-request-code"},{data:"ship_html",render:{display:"display",_:"sort"},className:"srp-request-ship"},{data:"zbk_loss_amount",render:(a,t)=>"display"===t?new Intl.NumberFormat(aaSrpSettings.locale).format(a)+" ISK":a,className:"srp-request-zbk-loss-amount text-end"},{data:"payout_amount",render:(a,t)=>"display"===t?`<span class="srp-payout-tooltip"><span class="srp-payout-amount d-block cursor-pointer">${new Intl.NumberFormat(aaSrpSettings.locale).format(a)} ISK</span><i class="aa-srp-fa-icon copy-text-fa-icon fa-regular fa-copy ms-2" data-clipboard-text="${a}" data-bs-tooltip="aa-srp" aria-label="${aaSrpSettings.translation.copyPayoutAmountToClipboard}" title="${aaSrpSettings.translation.copyPayoutAmountToClipboard}"></i></span>`:a,className:"srp-request-payout text-end"},{data:"request_status_icon",className:"srp-request-status text-center"},{data:"actions",className:"srp-request-actions text-end"},{data:"ship"},{data:"request_status_translated"},{data:"character"}],columnDefs:[{orderable:!1,targets:[7,8]},{visible:!1,targets:[9,10,11]},{width:115,targets:[8]}],order:[[0,"asc"]],filterDropDown:{columns:[{idx:1},{idx:11,title:aaSrpSettings.translation.filter.character},{idx:9,title:aaSrpSettings.translation.filter.ship},{idx:10,title:aaSrpSettings.translation.filter.requestStatus}],autoSize:!1,bootstrap:!0,bootstrap_version:5},paging:!1,createdRow:(a,t,e)=>{var r=t.request_code,s=t.request_status.toLowerCase(),t=t.payout_amount;$(a).attr("data-row-id",e).attr("data-srp-request-code",r).addClass("srp-request-status-"+s),$(a).find("span.srp-payout-amount").attr("data-value",t),"pending"!==s&&"rejected"!==s||($(a).find("td.srp-request-payout").addClass("srp-request-payout-amount-editable"),$(a).find("span.srp-payout-tooltip").attr("data-bs-tooltip","aa-srp").attr("title",aaSrpSettings.translation.changeSrpPayoutAmount),$(a).find("span.srp-payout-amount").addClass("srp-request-"+r).attr("data-pk",r).attr("data-params",`{csrfmiddlewaretoken:'${aaSrpSettings.csrfToken}'}`).attr("data-url",aaSrpSettings.url.changeSrpAmount.replace("SRP_REQUEST_CODE",r)))}}),n=(o.on("draw",()=>{a.editable({container:"body",selector:".srp-request-payout-amount-editable .srp-payout-amount",title:aaSrpSettings.translation.changeSrpPayoutHeader,type:"number",placement:"top",display:()=>!1,success:function(a,t){((a,t)=>{t=parseInt(t);var e=new Intl.NumberFormat(aaSrpSettings.locale).format(t)+" ISK";a.attr("data-value",t).addClass("srp-payout-amount-changed").html(e);let r=0;$("#tab_aasrp_srp_requests .srp-request-status-approved .srp-payout-amount").each((a,t)=>{r+=parseInt(t.getAttribute("data-value"))}),$(".srp-fleet-total-amount").html(new Intl.NumberFormat(aaSrpSettings.locale).format(r)+" ISK")})($(this),t)},validate:a=>{if(""===a)return aaSrpSettings.translation.editableValidate}}),[].slice.call(document.querySelectorAll('[data-bs-tooltip="aa-srp"]')).map(a=>new bootstrap.Tooltip(a))}),a=>{let e=0,r=0,s=0,o=0,n=0;$.each(a,(a,t)=>{r+=1,"Pending"===t.request_status&&(s+=1),"Approved"===t.request_status&&(e+=parseInt(t.payout_amount),o+=1),"Rejected"===t.request_status&&(n+=1)}),$(".srp-fleet-total-amount").html(new Intl.NumberFormat(aaSrpSettings.locale).format(e)+" ISK"),$(".srp-requests-total-count").html(r),$(".srp-requests-pending-count").html(s),$(".srp-requests-approved-count").html(o),$(".srp-requests-rejected-count").html(n)}),t=$("#srp-request-details"),r=$("#srp-request-accept"),l=$("#srp-request-accept-rejected"),d=$("#srp-request-reject"),e=$("#srp-request-remove");t.on("show.bs.modal",a=>{a=$(a.relatedTarget).data("link");$.get({url:a,success:a=>{t.find(".modal-body").html(a)}})}).on("hide.bs.modal",()=>{t.find(".modal-body").text("")}),r.on("show.bs.modal",a=>{let e=$(a.relatedTarget).data("link");$("#modal-button-confirm-accept-request").on("click",()=>{var a=r.find("form"),t=a.find('textarea[name="comment"]').val(),a=a.find('input[name="csrfmiddlewaretoken"]').val();$.post(e,{comment:t,csrfmiddlewaretoken:a}).done(a=>{!0===a[0].success&&o.ajax.reload(a=>{n(a)})}),r.modal("hide")})}).on("hide.bs.modal",()=>{r.find('textarea[name="comment"]').val(""),$("#modal-button-confirm-accept-request").unbind("click")}),l.on("show.bs.modal",a=>{let s=$(a.relatedTarget).data("link");$("#modal-button-confirm-accept-rejected-request").on("click",()=>{var a,t=l.find("form"),e=t.find('textarea[name="comment"]').val(),r=t.find('input[name="csrfmiddlewaretoken"]').val();""===e?(a=`<div class="aa-callout aa-callout-danger aasrp-form-field-errors clearfix"><p>${aaSrpSettings.translation.modal.form.error.fieldRequired}</p></div>`,t.find(".aasrp-form-field-errors").remove(),$(a).insertAfter($('textarea[name="comment"]'))):($.post(s,{comment:e,csrfmiddlewaretoken:r}).done(a=>{!0===a[0].success&&o.ajax.reload(a=>{n(a)})}),l.modal("hide"))})}).on("hide.bs.modal",()=>{l.find('textarea[name="comment"]').val(""),$(".aasrp-form-field-errors").remove(),$("#modal-button-confirm-accept-rejected-request").unbind("click")}),d.on("show.bs.modal",a=>{let s=$(a.relatedTarget).data("link");$("#modal-button-confirm-reject-request").on("click",()=>{var a,t=d.find("form"),e=t.find('textarea[name="comment"]').val(),r=t.find('input[name="csrfmiddlewaretoken"]').val();""===e?(a=`<div class="aa-callout aa-callout-danger aasrp-form-field-errors clearfix"><p>${aaSrpSettings.translation.modal.form.error.fieldRequired}</p></div>`,t.find(".aasrp-form-field-errors").remove(),$(a).insertAfter($('textarea[name="comment"]'))):($.post(s,{comment:e,csrfmiddlewaretoken:r}).done(a=>{!0===a[0].success&&o.ajax.reload(a=>{n(a)})}),d.modal("hide"))})}).on("hide.bs.modal",()=>{d.find('textarea[name="comment"]').val(""),$(".aasrp-form-field-errors").remove(),$("#modal-button-confirm-reject-request").unbind("click")}),e.on("show.bs.modal",a=>{let t=$(a.relatedTarget).data("link");$("#modal-button-confirm-remove-request").on("click",()=>{$.get(t,a=>{!0===a[0].success&&o.ajax.reload(a=>{n(a)})}),e.modal("hide")})}).on("hide.bs.modal",()=>{e.find('textarea[name="comment"]').val(""),$("#modal-button-confirm-remove-request").unbind("click")})});
//# sourceMappingURL=view-requests.min.js.map