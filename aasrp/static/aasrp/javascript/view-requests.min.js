$(document).ready(()=>{'use strict';const e=$('#tab_aasrp_srp_requests'),t=$('div.card-srp-request-bulk-actions'),a=()=>{const e=[];let t=0;if(document.querySelectorAll('#sidebar-menu .badge').forEach(a=>{const r=a.closest('li');r&&r.querySelector('ul.collapse')||(e.push(a),t+=parseInt(a.textContent))}),e.length>0&&t>0){const e=$('span.sidemenu-total-notifications-badge');if(0===t)return void e.remove();e.text(String(t))}};fetchGet({url:aaSrpSettings.url.requestsForSrpLink}).then(a=>{if(a){new DataTable(e,{language:aaSrpSettings.dataTables.language,data:a,layout:aaSrpSettings.dataTables.layout,ordering:aaSrpSettings.dataTables.ordering,columnControl:aaSrpSettings.dataTables.columnControl,paging:!1,columns:[{data:{display:e=>null===e.request_time?'':moment(e.request_time).utc().format(aaSrpSettings.datetimeFormat),sort:e=>null===e.request_time?'':e.request_time},className:'srp-request-time'},{data:'requester',className:'srp-request-requester'},{data:{display:e=>e.character_html.display,filter:e=>e.character_html.sort,sort:e=>e.character_html.sort},className:'srp-request-character'},{data:{display:e=>e.request_code_html.display,filter:e=>e.request_code_html.sort,sort:e=>e.request_code_html.sort},className:'srp-request-code'},{data:{display:e=>e.ship_html.display,filter:e=>e.ship_html.sort,sort:e=>e.ship_html.sort},className:'srp-request-ship'},{data:{display:e=>numberFormatter({value:e.zbk_loss_amount,locales:aaSrpSettings.locale,options:{style:'currency',currency:'ISK'}}),filter:e=>e.zbk_loss_amount,sort:e=>e.zbk_loss_amount},className:'srp-request-zbk-loss-amount text-end'},{data:{display:e=>e.payout_amount_html.display.replace('#payout_amount_localized#',numberFormatter({value:e.payout_amount_html.sort,locales:aaSrpSettings.locale,options:{style:'currency',currency:'ISK'}})),filter:e=>e.payout_amount_html.sort,sort:e=>e.payout_amount_html.sort},className:'srp-request-payout text-end'},{data:{display:e=>e.request_status_icon,sort:e=>e.request_status},className:'srp-request-status text-center'},{data:'actions',className:'srp-request-actions text-end'},{data:{display:e=>`<div class="checkbox"><label><input class="srp-requests-bulk-action" type="checkbox" name="${e.request_code}"><span class="cr"><i class="cr-icon fas fa-check"></i></span></label></div>`},className:'srp-request-bulk-actions-checkbox text-end'}],columnDefs:[{targets:[0,5,6],columnControl:_removeSearchFromColumnControl(aaSrpSettings.dataTables.columnControl,1)},{targets:[7,8,9],orderable:!1,columnControl:[{target:0,content:[]},{target:1,content:[]}]},{targets:[8],width:115}],order:[[0,'asc']],createdRow:(e,t,a)=>{const r=t.request_code,s=t.request_status.toLowerCase(),o=t.payout_amount;$(e).attr('data-row-id',a).attr('data-srp-request-code',r).addClass('srp-request-status-'+s),$(e).find('span.srp-payout-amount').attr('data-value',o),'pending'!==s&&'rejected'!==s||($(e).find('td.srp-request-payout').addClass('srp-request-payout-amount-editable'),$(e).find('span.srp-payout-tooltip').attr('data-bs-tooltip','aa-srp').attr('title',aaSrpSettings.translation.changeSrpPayoutAmount),$(e).find('span.srp-payout-amount').addClass(`cursor-pointer srp-request-${r}`).attr('data-pk',r).attr('data-params',`{csrfmiddlewaretoken:'${aaSrpSettings.csrfToken}'}`).attr('data-url',aaSrpSettings.url.changeSrpAmount.replace('SRP_REQUEST_CODE',r)))},initComplete:()=>{const a=e.DataTable(),s=(e,t)=>{$(e).click(()=>{$.fn.dataTable.ext.search=[];const e=(e,a,r,s)=>!s||t(s);$.fn.dataTable.ext.search.push(e),a.draw()})};[['#aasrp-srp-request-filter-all',()=>!0],['#aasrp-srp-request-filter-pending',e=>'Pending'===e.request_status],['#aasrp-srp-request-filter-approved',e=>'Approved'===e.request_status],['#aasrp-srp-request-filter-rejected',e=>'Rejected'===e.request_status]].forEach(([e,t])=>s(e,t)),_bootstrapTooltip({selector:'#tab_aasrp_srp_requests'}),a.on('draw',()=>{_bootstrapTooltip({selector:'#tab_aasrp_srp_requests'})}),e.editable({container:'body',selector:'.srp-request-payout-amount-editable .srp-payout-amount',title:aaSrpSettings.translation.changeSrpPayoutHeader,type:'number',placement:'top',display:()=>!1,success:function(e,t){r($(this),t)},validate:e=>{if(''===e)return aaSrpSettings.translation.editableValidate}});const o=$('td.srp-request-bulk-actions-checkbox input.srp-requests-bulk-action');o.each((e,a)=>{$(a).change(()=>{$(o).filter(':checked').length>0?t.removeClass('d-none'):t.addClass('d-none')})})}})}}).catch(e=>{console.error('Error fetching SRP requests:',e)});const r=(e,t)=>{t=parseInt(t);const a=numberFormatter({value:t,locales:aaSrpSettings.locale,options:{style:'currency',currency:'ISK'}});e.attr('data-value',t).addClass('srp-payout-amount-changed').html(a);let r=0;$('#tab_aasrp_srp_requests .srp-request-status-approved .srp-payout-amount').each((e,t)=>{r+=parseInt(t.getAttribute('data-value'))}),$('.srp-fleet-total-amount').html(numberFormatter({value:r,locales:aaSrpSettings.locale,options:{style:'currency',currency:'ISK'}}));e.parent().parent().find('.copy-to-clipboard-icon i').attr('data-clipboard-text',t)},s=e=>{let t=0,a=0,r=0,s=0,o=0;$.each(e,(e,n)=>{a+=1,'Pending'===n.request_status&&(r+=1),'Approved'===n.request_status&&(t+=parseInt(n.payout_amount),s+=1),'Rejected'===n.request_status&&(o+=1)}),$('.srp-fleet-total-amount').html(numberFormatter({value:t,locales:aaSrpSettings.locale,options:{style:'currency',currency:'ISK'}})),$('.srp-requests-total-count').html(a),$('.srp-requests-pending-count').html(r),$('.srp-requests-approved-count').html(s),$('.srp-requests-rejected-count').html(o)},o=e=>{e.unbind('click')},n=t=>{!0===t.success&&fetchGet({url:aaSrpSettings.url.requestsForSrpLink}).then(r=>{const o=e.DataTable();o.clear().rows.add(r).draw();try{const e=o.settings()[0],r=e&&e.oInit&&e.oInit.initComplete;if(r&&(Array.isArray(r)?r.forEach(t=>{'function'==typeof t&&t.call(o,e)}):'function'==typeof r&&r.call(o,e),t.pending_requests>=0)){const e=$('a[href="/ship-replacement/"] + span.badge');0===t.pending_requests?e.remove():e.text(t.pending_requests),a()}}catch(e){console.error('Error calling initComplete:',e)}s(r)}).catch(e=>{console.error('Error reloading SRP requests:',e)})},l=()=>{const e=$('td.srp-request-bulk-actions-checkbox input.srp-requests-bulk-action');return $(e).filter(':checked').map((e,t)=>$(t).attr('name')).get()},c=()=>{const e=$('td.srp-request-bulk-actions-checkbox input.srp-requests-bulk-action');return $(e).filter(':checked').map((e,t)=>$(t)).get()},d=$('#srp-request-details'),u=$('#srp-request-accept'),i=$('#srp-request-bulk-accept'),p=$('#srp-request-accept-rejected'),m=$('#srp-request-reject'),f=$('#srp-request-remove'),h=$('#srp-request-bulk-remove'),b='aa-callout aa-callout-danger aasrp-form-field-errors clearfix';d.on('show.bs.modal',e=>{const t=$(e.relatedTarget).data('link');fetchGet({url:t,responseIsJson:!1}).then(e=>{d.find('.modal-body').html(e)}).catch(e=>{console.error(`Error: ${e.message}`)})}).on('hide.bs.modal',()=>{d.find('.modal-body').text('')}),u.on('show.bs.modal',e=>{const t=$(e.relatedTarget).data('link');$('#modal-button-confirm-accept-request').on('click',()=>{const e=u.find('form'),a=e.find('textarea[name="comment"]').val(),r=e.find('input[name="csrfmiddlewaretoken"]').val();fetchPost({url:t,csrfToken:r,payload:{comment:a},responseIsJson:!0}).then(e=>{n(e)}).catch(e=>{console.error(`Error: ${e.message}`)}),u.modal('hide')})}).on('hide.bs.modal',()=>{u.find('textarea[name="comment"]').val(''),o($('#modal-button-confirm-accept-request'))}),p.on('show.bs.modal',e=>{const t=$(e.relatedTarget).data('link');$('#modal-button-confirm-accept-rejected-request').on('click',()=>{const e=p.find('form'),a=e.find('textarea[name="comment"]').val(),r=e.find('input[name="csrfmiddlewaretoken"]').val();if(''===a){const t=`<div class="${b}"><p>${aaSrpSettings.translation.modal.form.error.fieldRequired}</p></div>`;e.find('.aasrp-form-field-errors').remove(),$(t).insertAfter($('textarea[name="comment"]'))}else fetchPost({url:t,csrfToken:r,payload:{comment:a},responseIsJson:!0}).then(e=>{n(e)}).catch(e=>{console.error(`Error: ${e.message}`)}),p.modal('hide')})}).on('hide.bs.modal',()=>{p.find('textarea[name="comment"]').val(''),$('.aasrp-form-field-errors').remove(),o($('#modal-button-confirm-accept-rejected-request'))}),m.on('show.bs.modal',e=>{const t=$(e.relatedTarget).data('link');$('#modal-button-confirm-reject-request').on('click',()=>{const e=m.find('form'),a=e.find('textarea[name="comment"]').val(),r=e.find('input[name="csrfmiddlewaretoken"]').val();if(''===a){const t=`<div class="${b}"><p>${aaSrpSettings.translation.modal.form.error.fieldRequired}</p></div>`;e.find('.aasrp-form-field-errors').remove(),$(t).insertAfter($('textarea[name="comment"]'))}else fetchPost({url:t,csrfToken:r,payload:{comment:a},responseIsJson:!0}).then(e=>{n(e)}).catch(e=>{console.error(`Error: ${e.message}`)}),m.modal('hide')})}).on('hide.bs.modal',()=>{m.find('textarea[name="comment"]').val(''),$('.aasrp-form-field-errors').remove(),o($('#modal-button-confirm-reject-request'))}),f.on('show.bs.modal',e=>{const t=$(e.relatedTarget).data('link');$('#modal-button-confirm-remove-request').on('click',()=>{fetchGet({url:t}).then(e=>{n(e)}).catch(e=>{console.error(`Error: ${e.message}`)}),f.modal('hide')})}).on('hide.bs.modal',()=>{f.find('textarea[name="comment"]').val(''),o($('#modal-button-confirm-remove-request'))}),i.on('show.bs.modal',e=>{const a=$(e.relatedTarget).data('link'),r=i.find('form').find('input[name="csrfmiddlewaretoken"]').val();$('#modal-button-confirm-bulk-accept-requests').on('click',()=>{const e=l();fetchPost({url:a,csrfToken:r,payload:{srp_request_codes:e},responseIsJson:!0}).then(e=>{n(e);c().forEach(e=>{$(e).prop('checked',!1)}),t.addClass('d-none')}).catch(e=>{console.error(`Error: ${e.message}`)}),i.modal('hide')})}).on('hide.bs.modal',()=>{o($('#modal-button-confirm-bulk-accept-requests'))}),h.on('show.bs.modal',e=>{const a=$(e.relatedTarget).data('link'),r=h.find('form').find('input[name="csrfmiddlewaretoken"]').val();$('#modal-button-confirm-bulk-remove-requests').on('click',()=>{const e=l();fetchPost({url:a,csrfToken:r,payload:{srp_request_codes:e},responseIsJson:!0}).then(e=>{n(e);c().forEach(e=>{$(e).prop('checked',!1)}),t.addClass('d-none')}).catch(e=>{console.error(`Error: ${e.message}`)}),h.modal('hide')})}).on('hide.bs.modal',()=>{o($('#modal-button-confirm-bulk-remove-requests'))}),$('#aasrp-bulk-action-clear-selection').on('click',()=>{c().forEach(e=>{$(e).prop('checked',!1)}),t.addClass('d-none')})});
//# sourceMappingURL=view-requests.min.js.map